<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
   <title>MindScribe | Mobile</title>
  <meta name="description" content="AI-powered voice journaling app">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="../../Assets/icon.png">
  <link rel="apple-touch-icon" href="../../Assets/icon.png">
  
  <!-- PWA Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#5D5FEF">
  
  <!-- Enhanced fullscreen support for iOS -->
  <meta name="apple-mobile-web-app-title" content="MindScribe">
  <meta name="application-name" content="MindScribe">
  
  <!-- Web App Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../CSS/styles.css">
  <!-- Split mobile styles into two files for better organization -->
  <link rel="stylesheet" href="../CSS/mobile-styles.css">
  <link rel="stylesheet" href="../CSS/mobile-components.css">
  <style>
    /* Modern font for the diet wizard */
    .modern-diet-wizard, .modern-diet-wizard input, .modern-diet-wizard select, .modern-diet-wizard label, .modern-diet-wizard button {
      font-family: 'Inter', 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, 'system-ui', sans-serif !important;
      letter-spacing: 0.01em;
    }
    .modern-diet-wizard .wizard-step {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 16px 0 rgba(93,95,239,0.07);
      padding: 28px 18px 22px 18px;
      margin-bottom: 10px;
      transition: box-shadow 0.2s;
    }
    .modern-diet-wizard label {
      font-size: 1.08em;
      font-weight: 600;
      color: #232347;
      margin-bottom: 10px;
      display: block;
      letter-spacing: 0.01em;
    }
    .modern-diet-wizard input[type="number"],
    .modern-diet-wizard input[type="text"],
    .modern-diet-wizard select {
      width: 100%;
      padding: 13px 14px;
      border: 1.5px solid #e3e6f0;
      border-radius: 12px;
      font-size: 1.05em;
      background: #f7f8ff;
      margin-bottom: 18px;
      margin-top: 6px;
      transition: border 0.2s, box-shadow 0.2s;
      outline: none;
      color: #232347;
    }
    .modern-diet-wizard input:focus, .modern-diet-wizard select:focus {
      border-color: #5D5FEF;
      box-shadow: 0 0 0 2px #5d5fef22;
    }
    .modern-diet-wizard .wizard-btn {
      background: linear-gradient(90deg,#5D5FEF 70%,#34D399 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 26px;
      font-size: 1.05em;
      font-weight: 600;
      margin: 0 6px;
      cursor: pointer;
      box-shadow: 0 1px 6px 0 rgba(93,95,239,0.08);
      transition: background 0.18s, box-shadow 0.18s;
    }
    .modern-diet-wizard .wizard-btn.back {
      background: #e3e6f0;
      color: #5D5FEF;
    }
    .modern-diet-wizard .wizard-btn:active {
      box-shadow: 0 2px 10px 0 rgba(93,95,239,0.13);
    }
    .modern-diet-wizard .radio-group label {
      font-weight: 500;
      font-size: 1em;
      margin-right: 18px;
      color: #232347;
    }
    .modern-diet-wizard .radio-group input[type="radio"] {
      accent-color: #5D5FEF;
      margin-right: 6px;
    }

    /* Modern font and placeholder styles for diet wizard */
    #dietWizardBox, .modern-diet-wizard, #dietWizardForm {
      font-family: 'Inter', 'system-ui', 'Segoe UI', Arial, sans-serif !important;
    }
    #dietWizardForm label {
      font-size: 1.08em;
      font-weight: 500;
      color: #232347;
      letter-spacing: 0.01em;
      margin-bottom: 8px;
      display: block;
    }
    #dietWizardForm input[type="number"],
    #dietWizardForm input[type="text"],
    #dietWizardForm select {
      width: 100%;
      padding: 13px 14px;
      border-radius: 12px;
      border: 1.5px solid #e0e3f3;
      background: #f7f8ff;
      font-size: 1.05em;
      font-family: inherit;
      margin-bottom: 10px;
      transition: border 0.2s;
      color: #232347;
    }
    #dietWizardForm input[type="number"]::placeholder,
    #dietWizardForm input[type="text"]::placeholder {
      color: #b3b3cc;
      font-size: 1em;
      font-family: inherit;
      opacity: 1;
    }
    #dietWizardForm select:invalid {
      color: #b3b3cc;
    }
    #dietWizardForm select option[value=""] {
      color: #b3b3cc;
    }
    #dietWizardForm .wizard-btn {
      font-family: inherit;
      font-size: 1.05em;
      border-radius: 10px;
      padding: 11px 22px;
      background: linear-gradient(90deg, #5D5FEF 70%, #34D399 100%);
      color: #fff;
      border: none;
      margin: 0 4px;
      font-weight: 600;
      box-shadow: 0 2px 8px 0 rgba(93,95,239,0.08);
      transition: background 0.2s, box-shadow 0.2s;
    }
    #dietWizardForm .wizard-btn.back {
      background: #e0e3f3;
      color: #232347;
    }
    #dietWizardForm .wizard-btn:active {
      box-shadow: 0 1px 3px 0 rgba(93,95,239,0.10);
    }
    #dietWizardForm .wizard-step {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px 0 rgba(93,95,239,0.07);
      padding: 22px 18px 18px 18px;
      margin-bottom: 10px;
      min-width: 0;
    }
    #dietWizardForm .radio-group label {
      font-size: 1em;
      font-weight: 500;
      color: #232347;
      margin-right: 18px;
    }
    #dietWizardForm .radio-group input[type="radio"] {
      accent-color: #5D5FEF;
      margin-right: 6px;
    }
    #dietWizardForm input:focus, #dietWizardForm select:focus {
      border-color: #5D5FEF;
      outline: none;
    }
  </style>
</head>
<body>
  <div class="mobile-container">
    <div class="mobile-view" id="homeView">
      <div class="mobile-header">
        <h1>MindScribe</h1>
      </div>
      
      <div class="mobile-content">
        <div class="welcome-card">
          <div class="welcome-avatar">
            <i class="fas fa-user-circle"></i>
          </div>
          <h2>Welcome back</h2>
          <p id="welcomeUserEmail">track your nutrition</p>
        </div>
        
        <div class="stats-cards">
          <div class="stat-card">
            <div class="stat-icon" style="background-color: rgba(93, 95, 239, 0.1); color: var(--primary);">
              <i class="fas fa-utensils"></i>
            </div>
            <div class="stat-content">
              <h3>Recent Meals</h3>
              <p><span id="mealCount">0</span> analyzed</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon" style="background-color: rgba(52, 211, 153, 0.1); color: var(--accent);">
              <i class="fas fa-smile"></i>
            </div>
            <div class="stat-content">
               <h3>Avg. Health Score</h3>
              <p><span id="avgHealthScore">--</span></p>
            </div>
          </div>
        </div>
        
        <div class="nutrition-style-card">
          <h3>Your Nutrition Style <button id="refreshNutritionStyle" class="refresh-btn"><i class="fas fa-sync-alt"></i></button></h3>
          <div class="nutrition-meter">
            <div class="meter-bar">
              <div class="meter-fill" id="nutritionStyleMeter"></div>
            </div>
            <div class="meter-label" id="nutritionStyleLabel">Click to analyze your style</div>
          </div>
        </div>
        
        <div class="section-title">
          <h3>Quick Actions</h3>
        </div>
        
        <div class="action-buttons">
          <button class="action-btn" onclick="switchTab('aiView')">
            <i class="fas fa-robot"></i>
            <span>Ask AI</span>
          </button>
        </div>
        <div class="action-buttons">
          <button class="action-btn" onclick="switchTab('scanView')">
            <i class="fas fa-camera"></i>
            <span>Scan Food</span>
          </button>
        </div>
        
        <div class="section-title">
          <h3>Nutritional Tips</h3>
        </div>
        <div class="tips-carousel" id="tipsCarousel">
          <div class="tip-card" id="tipCard">
            <div class="tip-icon" id="tipIcon"><i class="fas fa-leaf"></i></div>
            <h4 id="tipTitle">Balanced Diet</h4>
            <p id="tipText">Include a variety of fruits, vegetables, lean proteins, and whole grains in your meals.</p>
          </div>
          <div class="tip-controls">
            <div class="tip-indicator" id="tipIndicator"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="mobile-view hidden" id="activityView">
      <div class="mobile-header">
        <h1>Activity</h1>
      </div>
      <div class="mobile-content">
        <div class="section-container">
          <!-- Scan Food Section (moved from Scan/Record tab) -->
          <div class="activity-section">
            <div class="section-title">
              <h3>Scan Food</h3>
            </div>
            <div class="action-buttons scan-buttons">
              <button id="startCameraButton" class="btn btn-primary fade-in">
                <i class="fas fa-camera"></i> Take a Photo
              </button>
              <button id="logFoodButton" class="btn btn-secondary fade-in">
                <i class="fas fa-keyboard"></i> Log Food Manually
              </button>
              <div class="upload-container fade-in delay-1">
                <input type="file" id="fileUpload" accept="image/*">
                <label for="fileUpload" class="upload-label">
                  <i class="fas fa-cloud-upload-alt"></i> 
                  <span>Upload a Photo</span>
                </label>
              </div>
              <button id="viewFoodHistoryBtn" class="btn btn-outline fade-in" style="margin-top: 10px;" onclick="switchTab('communityView')">
                <i class="fas fa-history"></i> View Food History
              </button>
            </div>
            <div id="logFoodContainer" class="log-food-container fade-in" style="display:none;">
              <div class="log-food-header">
                <h3>Log Food Manually</h3>
                <p>Describe the food you've eaten (e.g., "200g oatmeal with 2 spoons of peanut butter and a 100ml glass of milk")</p>
              </div>
              <div class="food-description-wrapper">
                <textarea id="foodDescription" class="food-description" placeholder="Describe your meal here..."></textarea>
                <button id="speechToTextBtn" class="speech-to-text-btn">
                  <i class="fas fa-microphone"></i>
                </button>
              </div>
              <div class="speech-status" id="speechStatus" style="display: none;">
                <i class="fas fa-microphone-alt pulse"></i>
                <span>Listening...</span>
              </div>
              <div class="log-food-actions">
                <button id="submitFoodLog" class="btn btn-primary">
                  <i class="fas fa-check"></i> Analyze Food
                </button>
                <button id="cancelFoodLog" class="btn btn-secondary">
                  <i class="fas fa-times"></i> Cancel
                </button>
              </div>
            </div>
            <div class="preview-container fade-in delay-2" id="previewContainer">
              <button class="btn-icon" id="closePreviewButton">
                <i class="fas fa-times"></i>
              </button>
              <video id="video" autoplay playsinline muted></video>
              <img id="photo" style="display:none;">
              <canvas id="canvas" style="display:none;"></canvas>
              <div class="preview-controls">
                <button id="captureButton" class="btn btn-secondary capture-btn" style="display:none;">
                  <i class="fas fa-camera"></i> Capture
                </button>
              </div>
            </div>
            <div class="results-container fade-in delay-3" id="results" style="display:none;"></div>
          </div>
  <div class="activity-section">
            <div class="section-title">
              <h3>Find Exercises</h3>
            </div>
            
            <div class="exercise-wizard">
              <!-- Step 1: Initial Search Box -->
              <div class="wizard-step active" id="step-1">
                <div class="exercise-search-box modern-exercise-search-box">
                  <input type="text" id="exerciseSearchInput" placeholder="What exercise are you looking for?" class="modern-exercise-input">
                  <button id="startSearchBtn" class="modern-exercise-search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
              
              <!-- Step 2: Filter Options -->
              <div class="wizard-step" id="step-2">
                <div class="option-card">
                  <h4>Exercise Type</h4>
                  <div class="option-grid" id="typeOptions">
                    <div class="option-item" data-value="cardio">
                      <i class="fas fa-running"></i>
                      <span>Cardio</span>
                    </div>
                    <div class="option-item" data-value="strength">
                      <i class="fas fa-dumbbell"></i>
                      <span>Strength</span>
                    </div>
                    <div class="option-item" data-value="stretching">
                      <i class="fas fa-child"></i>
                      <span>Stretching</span>
                    </div>
                    <div class="option-item" data-value="powerlifting">
                      <i class="fas fa-weight-hanging"></i>
                      <span>Powerlifting</span>
                    </div>
                    <div class="option-item" data-value="olympic_weightlifting">
                      <i class="fas fa-award"></i>
                      <span>Olympic</span>
                    </div>
                    <div class="option-item" data-value="plyometrics">
                      <i class="fas fa-bolt"></i>
                      <span>Plyometrics</span>
                    </div>
                    <div class="option-item" data-value="strongman">
                      <i class="fas fa-fist-raised"></i>
                      <span>Strongman</span>
                    </div>
                    <div class="option-item" data-value="" selected>
                      <i class="fas fa-globe"></i>
                      <span>All Types</span>
                    </div>
                  </div>
                  <div class="wizard-nav">
                    <button class="wizard-btn back" data-step="1">
                      <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="wizard-btn next" data-step="3">
                      Next <i class="fas fa-arrow-right"></i>
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Step 3: Muscle Group Selection -->
              <div class="wizard-step" id="step-3">
                <div class="option-card">
                  <h4>Target Muscle</h4>
                  <div class="muscle-selector">
                    <div class="body-map">
                      <img src="/Assets/body-map.png" alt="Body Map" id="bodyMapImg">
                      <div class="muscle-tooltip" id="muscleTooltip"></div>
                    </div>
                    <div class="muscle-list">
                      <div class="option-item muscle-option" data-value="abdominals">Abdominals</div>
                      <div class="option-item muscle-option" data-value="abductors">Abductors</div>
                      <div class="option-item muscle-option" data-value="adductors">Adductors</div>
                      <div class="option-item muscle-option" data-value="biceps">Biceps</div>
                      <div class="option-item muscle-option" data-value="calves">Calves</div>
                      <div class="option-item muscle-option" data-value="chest">Chest</div>
                      <div class="option-item muscle-option" data-value="forearms">Forearms</div>
                      <div class="option-item muscle-option" data-value="glutes">Glutes</div>
                      <div class="option-item muscle-option" data-value="hamstrings">Hamstrings</div>
                      <div class="option-item muscle-option" data-value="lats">Lats</div>
                      <div class="option-item muscle-option" data-value="lower_back">Lower Back</div>
                      <div class="option-item muscle-option" data-value="middle_back">Middle Back</div>
                      <div class="option-item muscle-option" data-value="neck">Neck</div>
                      <div class="option-item muscle-option" data-value="quadriceps">Quadriceps</div>
                      <div class="option-item muscle-option" data-value="traps">Traps</div>
                      <div class="option-item muscle-option" data-value="triceps">Triceps</div>
                    </div>
                  </div>
                  <div class="wizard-nav">
                    <button class="wizard-btn back" data-step="2">
                      <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="wizard-btn next" data-step="4">
                      Next <i class="fas fa-arrow-right"></i>
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Step 4: Difficulty Selection -->
              <div class="wizard-step" id="step-4">
                <div class="option-card">
                  <h4>Difficulty Level</h4>
                  <div class="difficulty-slider">
                    <div class="difficulty-options">
                      <div class="difficulty-option" data-value="beginner">
                        <div class="difficulty-icon">
                          <i class="fas fa-seedling"></i>
                        </div>
                        <span>Beginner</span>
                      </div>
                      <div class="difficulty-option" data-value="intermediate">
                        <div class="difficulty-icon">
                          <i class="fas fa-fire"></i>
                        </div>
                        <span>Intermediate</span>
                      </div>
                      <div class="difficulty-option" data-value="expert">
                        <div class="difficulty-icon">
                          <i class="fas fa-fire-alt"></i>
                        </div>
                        <span>Expert</span>
                      </div>
                      <div class="difficulty-option selected" data-value="">
                        <div class="difficulty-icon">
                          <i class="fas fa-layer-group"></i>
                        </div>
                        <span>All Levels</span>
                      </div>
                    </div>
                  </div>
                  <div class="wizard-nav">
                    <button class="wizard-btn back" data-step="3">
                      <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="wizard-btn find" id="findExercisesBtn">
                      <i class="fas fa-dumbbell"></i> Find Exercises
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Hidden input fields to store selections -->
              <input type="hidden" id="exerciseType" value="">
              <input type="hidden" id="exerciseMuscle" value="">
              <input type="hidden" id="exerciseDifficulty" value="">
            </div>
            
            <div id="exerciseResults" class="exercise-results">
              <!-- Exercise results will be inserted here by JavaScript -->
            </div>
            
            <div class="empty-results" id="emptyExercises" style="display: none;">
              <div class="empty-history-content">
                <i class="fas fa-dumbbell"></i>
                <h3>No exercises found</h3>
                <p>Try adjusting your filters or search term</p>
              </div>
            </div>
            
            <div class="loading-indicator" id="exerciseLoading" style="display: none;">
              <div class="spinner"></div>
              <p>Finding exercises...</p>
            </div>
          </div>

         <div class="activity-section">
  <div class="section-title">
    <h3>Personal Diet Plan</h3>
  </div>
  <div id="dietWizardBox" class="modern-diet-wizard">
    <form id="dietWizardForm">
      <div class="wizard-step" id="step-age">
        <label for="wizardAge">How old are you?</label>
        <input type="number" id="wizardAge" name="age" min="10" max="120" placeholder="E.g. 25" required>
        <div class="wizard-nav">
          <button type="button" class="wizard-btn next">Next</button>
        </div>
      </div>
      <div class="wizard-step" id="step-weight" style="display:none;">
        <label for="wizardWeight">Your weight (kg)</label>
        <input type="number" id="wizardWeight" name="weight" min="20" max="300" placeholder="E.g. 68" required>
        <div class="wizard-nav">
          <button type="button" class="wizard-btn back">Back</button>
          <button type="button" class="wizard-btn next">Next</button>
        </div>
      </div>
      <div class="wizard-step" id="step-height" style="display:none;">
        <label for="wizardHeight">Your height (cm)</label>
        <input type="number" id="wizardHeight" name="height" min="80" max="250" placeholder="E.g. 172" required>
        <div class="wizard-nav">
          <button type="button" class="wizard-btn back">Back</button>
          <button type="button" class="wizard-btn next">Next</button>
        </div>
      </div>
      <div class="wizard-step" id="step-gender" style="display:none;">
        <label for="wizardGender">Gender</label>
        <select id="wizardGender" name="gender" required>
          <option value="">Select gender...</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
        <div class="wizard-nav">
          <button type="button" class="wizard-btn back">Back</button>
          <button type="button" class="wizard-btn next">Next</button>
        </div>
      </div>
      <div class="wizard-step" id="step-activity" style="display:none;">
        <label for="wizardActivity">Activity level</label>
        <select id="wizardActivity" name="activity_level" required>
          <option value="">Select activity...</option>
          <option value="sedentary">Not very active</option>
          <option value="light">Lightly active</option>
          <option value="moderate">Moderately active</option>
          <option value="active">Active</option>
          <option value="very_active">Very active</option>
        </select>
        <div class="wizard-nav">
          <button type="button" class="wizard-btn back">Back</button>
          <button type="button" class="wizard-btn next">Next</button>
        </div>
      </div>
      <div class="wizard-step" id="step-goal" style="display:none;">
        <label for="wizardGoal">Your main goal</label>
        <select id="wizardGoal" name="goal" required>
          <option value="">Select goal...</option>
          <option value="lose_weight">Lose weight</option>
          <option value="maintain">Maintain weight</option>
          <option value="gain_muscle">Gain muscle</option>
          <option value="other">Other</option>
        </select>
        <div class="wizard-nav">
          <button type="button" class="wizard-btn back">Back</button>
          <button type="button" class="wizard-btn next">Next</button>
        </div>
      </div>
      <div class="wizard-step" id="step-allergies" style="display:none;">
        <label for="wizardAllergies">Any allergies?</label>
        <select id="wizardAllergiesSelect" name="allergies_select">
          <option value="NA">None</option>
          <option value="custom">Other (type below)</option>
        </select>
        <input type="text" id="wizardAllergies" name="allergies" placeholder="E.g. peanuts, gluten" style="display:none; margin-top:6px;">
        <div class="wizard-nav">
          <button type="button" class="wizard-btn back">Back</button>
          <button type="button" class="wizard-btn next">Next</button>
        </div>
      </div>
      <div class="wizard-step" id="step-dislikes" style="display:none;">
        <label for="wizardDislikes">Foods you dislike?</label>
        <select id="wizardDislikesSelect" name="dislikes_select">
          <option value="NA">None</option>
          <option value="custom">Other (type below)</option>
        </select>
        <input type="text" id="wizardDislikes" name="dislikes" placeholder="E.g. broccoli, fish" style="display:none; margin-top:6px;">
        <div class="wizard-nav">
          <button type="button" class="wizard-btn back">Back</button>
          <button type="button" class="wizard-btn next">Next</button>
        </div>
      </div>
      <div class="wizard-step" id="step-email-deliver" style="display:none;">
        <label>Get your personalized diet plan</label>
        <div class="wizard-nav">
          <button type="button" class="wizard-btn back">Back</button>
          <button type="submit" class="wizard-btn submit" id="getPlanBtn">Get My Plan</button>
        </div>
      </div>
    </form>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var dietWizardForm = document.getElementById('dietWizardForm');
  if (!dietWizardForm) return;
  const steps = [
    'step-age',
    'step-weight',
    'step-height',
    'step-gender',
    'step-activity',
    'step-goal',
    'step-allergies',
    'step-dislikes',
    'step-email-deliver'
  ];
  let currentStep = 0;
  function showStep(idx) {
    steps.forEach((id, i) => {
      const el = document.getElementById(id);
      if (el) {
        el.style.display = i === idx ? 'block' : 'none';
        el.style.visibility = 'visible';
        el.style.height = 'auto';
        el.style.opacity = 1;
      }
    });
  }
  function validateStep(idx) {
    switch (steps[idx]) {
      case 'step-age':
        return document.getElementById('wizardAge').value;
      case 'step-weight':
        return document.getElementById('wizardWeight').value;
      case 'step-height':
        return document.getElementById('wizardHeight').value;
      case 'step-gender':
        return document.getElementById('wizardGender').value;
      case 'step-activity':
        return document.getElementById('wizardActivity').value;
      case 'step-goal':
        return document.getElementById('wizardGoal').value;
      case 'step-allergies':
        if (document.getElementById('wizardAllergiesSelect').value === 'custom') {
          return document.getElementById('wizardAllergies').value;
        }
        return true;
      case 'step-dislikes':
        if (document.getElementById('wizardDislikesSelect').value === 'custom') {
          return document.getElementById('wizardDislikes').value;
        }
        return true;
      case 'step-email-deliver':
        return true;
      default:
        return true;
    }
  }
  dietWizardForm.querySelectorAll('.wizard-btn.next').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      if (!validateStep(currentStep)) {
        alert('Please fill in the required field.');
        return;
      }
      if (currentStep < steps.length - 1) {
        currentStep++;
        showStep(currentStep);
      }
    });
  });
  dietWizardForm.querySelectorAll('.wizard-btn.back').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
      }
    });
  });
  showStep(currentStep);
  // Allergies/dislikes custom input logic
  const allergiesSelect = document.getElementById('wizardAllergiesSelect');
  const allergiesInput = document.getElementById('wizardAllergies');
  if (allergiesSelect && allergiesInput) {
    allergiesSelect.addEventListener('change', function() {
      allergiesInput.style.display = this.value === 'custom' ? 'block' : 'none';
      if (this.value !== 'custom') allergiesInput.value = '';
    });
  }
  const dislikesSelect = document.getElementById('wizardDislikesSelect');
  const dislikesInput = document.getElementById('wizardDislikes');
  if (dislikesSelect && dislikesInput) {
    dislikesSelect.addEventListener('change', function() {
      dislikesInput.style.display = this.value === 'custom' ? 'block' : 'none';
      if (this.value !== 'custom') dislikesInput.value = '';
    });
  }
  dietWizardForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    showStep(currentStep);
    if (!validateStep(currentStep)) {
      const stepEl = document.getElementById(steps[currentStep]);
      if (stepEl) {
        const invalid = stepEl.querySelector(':invalid');
        if (invalid) invalid.focus();
      }
      alert('Please fill in the required field.');
      return;
    }
    const getPlanBtn = document.getElementById('getPlanBtn');
    if (getPlanBtn) {
      getPlanBtn.disabled = true;
      getPlanBtn.textContent = 'Processing...';
      getPlanBtn.style.background = '#22c55e'; // Tailwind green-500
      getPlanBtn.style.color = '#fff';
    }
    const data = {
      user_email: localStorage.getItem('userEmail') || '',
      age: document.getElementById('wizardAge').value,
      weight: document.getElementById('wizardWeight').value,
      height: document.getElementById('wizardHeight').value,
      gender: document.getElementById('wizardGender').value,
      activity_level: document.getElementById('wizardActivity').value,
      goal: document.getElementById('wizardGoal').value,
      allergies: allergiesSelect && allergiesSelect.value === 'custom' ? allergiesInput.value : 'NA',
      dislikes: dislikesSelect && dislikesSelect.value === 'custom' ? dislikesInput.value : 'NA',
      email_deliver: 'Yes'
    };
    try {
      const response = await fetch('http://127.0.0.1:8000/diet-plan', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(data)
      });
      if (!response.ok) {
        throw new Error('Server error');
      }
      // Always show success message, don't display plan
      alert('Your personalized diet plan will be sent to your email!');
      dietWizardForm.reset();
      showStep(0);
      currentStep = 0;
    } catch (err) {
      alert('Failed to generate diet plan. Please try again.');
    } finally {
      if (getPlanBtn) {
        getPlanBtn.disabled = false;
        getPlanBtn.textContent = 'Get My Plan';
        getPlanBtn.style.background = '';
        getPlanBtn.style.color = '';
      }
    }
  });

  // Modernize placeholders for wizard fields
  var age = document.getElementById('wizardAge');
  if (age) age.placeholder = 'E.g. 25';
  var weight = document.getElementById('wizardWeight');
  if (weight) weight.placeholder = 'E.g. 70';
  var height = document.getElementById('wizardHeight');
  if (height) height.placeholder = 'E.g. 175';
  var allergies = document.getElementById('wizardAllergies');
  if (allergies) allergies.placeholder = 'E.g. peanuts, shellfish';
  var dislikes = document.getElementById('wizardDislikes');
  if (dislikes) dislikes.placeholder = 'E.g. broccoli, mushrooms';
});
</script>
<script>
// --- Activity Tracking Logic ---
const ACTIVITY_API_URL = "http://127.0.0.1:8000/log-activity";
const ACTIVITY_HISTORY_API_URL = "http://127.0.0.1:8000/activity-history"; // You need to implement this endpoint in backend
const activityTypes = [
  { key: 'sleep', label: 'Sleep', form: 'sleepForm', input: 'sleepHours', unit: 'hours' },
  { key: 'hydration', label: 'Hydration', form: 'hydrationForm', input: 'hydrationLiters', unit: 'liters' },
  { key: 'screen_time', label: 'Screen Time', form: 'screenTimeForm', input: 'screenTimeHours', unit: 'hours' },
  { key: 'walk', label: 'Walk', form: 'walkForm', input: 'walkSteps', unit: 'steps' }
];

function getUserEmail() {
  return localStorage.getItem('userEmail') || '';
}

function getCurrentTimestamp() {
  return new Date().toISOString();
}

function showActivityTotals(totals) {
  let html = '<div class="activity-totals-row" style="display:flex;justify-content:space-around;margin:10px 0 18px 0;gap:10px;">';
  activityTypes.forEach(act => {
    const val = totals[act.key] || 0;
    html += `<div style="text-align:center;font-size:0.98em;min-width:60px;">
      <div style="font-weight:600;">${val} <span style="font-size:0.85em;color:#888;">${act.unit}</span></div>
      <div style="font-size:0.93em;color:#5D5FEF;">${act.label}</div>
    </div>`;
  });
  html += '</div>';
  let totalsDiv = document.getElementById('activityTotalsRow');
  if (!totalsDiv) {
    totalsDiv = document.createElement('div');
    totalsDiv.id = 'activityTotalsRow';
    const iconsRow = document.querySelector('.activity-icons-row');
    if (iconsRow) iconsRow.parentNode.insertBefore(totalsDiv, iconsRow.nextSibling);
  }
  totalsDiv.innerHTML = html;
}

async function fetchActivityTotals() {
  const user_email = getUserEmail();
  if (!user_email) return;
  try {
    const resp = await fetch(ACTIVITY_HISTORY_API_URL + `?user_email=${encodeURIComponent(user_email)}`);
    if (!resp.ok) throw new Error('Failed to fetch activity history');
    const data = await resp.json();
    // data should be { sleep: x, hydration: y, screen_time: z, walk: w }
    showActivityTotals(data.totals || {});
  } catch (e) {
    // fallback: show zeros
    showActivityTotals({});
  }
}

document.addEventListener('DOMContentLoaded', function() {
  fetchActivityTotals();
  activityTypes.forEach(act => {
    const form = document.getElementById(act.form);
    if (form) {
      form.onsubmit = async function(e) {
        e.preventDefault();
        const user_email = getUserEmail();
        const value = parseFloat(document.getElementById(act.input).value);
        if (!user_email || isNaN(value) || value <= 0) {
          alert('Please enter a valid value and make sure you are logged in.');
          return;
        }
        const now = new Date();
        const timestamp = now.toISOString();
        // Send to backend
        try {
          const resp = await fetch(ACTIVITY_API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({
              user_email,
              activity: act.key,
              count: value,
              timestamp
            })
          });
          if (!resp.ok) throw new Error('Failed to log activity');
          document.getElementById(act.form.replace('Form', 'Modal')).style.display = 'none';
          document.getElementById(act.input).value = '';
          await fetchActivityTotals();
        } catch (err) {
          alert('Failed to log activity. Please try again.');
        }
      };
    }
  });
});
</script>
          </div>
          <br>
          <!-- Coming Soon Section for Additional Features -->
<div class="activity-section">
          <div class="section-title">
            <h3>Activity Tracking</h3>
          </div>
          <div class="activity-icons-row" style="display:flex;justify-content:space-around;gap:18px;margin:18px 0 10px 0;">
            <div class="activity-icon-btn" id="sleepIconBtn" style="text-align:center;cursor:pointer;">
              <i class="fas fa-bed" style="font-size:2em;color:#5D5FEF;"></i>
              <div style="font-size:0.95em;margin-top:4px;">Sleep</div>
            </div>
            <div class="activity-icon-btn" id="hydrationIconBtn" style="text-align:center;cursor:pointer;">
              <i class="fas fa-tint" style="font-size:2em;color:#34D399;"></i>
              <div style="font-size:0.95em;margin-top:4px;">Hydration</div>
            </div>
            <div class="activity-icon-btn" id="screenTimeIconBtn" style="text-align:center;cursor:pointer;">
              <i class="fas fa-mobile-alt" style="font-size:2em;color:#F59E42;"></i>
              <div style="font-size:0.95em;margin-top:4px;">Screen</div>
            </div>
            <div class="activity-icon-btn" id="walkIconBtn" style="text-align:center;cursor:pointer;">
              <i class="fas fa-walking" style="font-size:2em;color:#232347;"></i>
              <div style="font-size:0.95em;margin-top:4px;">Walk</div>
            </div>
          </div>
          <!-- Modals for each activity -->
          <div class="activity-modal" id="sleepModal" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);align-items:center;justify-content:center;">
            <div style="background:#fff;padding:22px 18px 18px 18px;border-radius:16px;max-width:90vw;width:320px;box-shadow:0 2px 12px 0 rgba(93,95,239,0.13);position:relative;">
              <button class="close-modal-btn" data-modal="sleepModal" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.2em;color:#888;cursor:pointer;"><i class="fas fa-times"></i></button>
              <h3 style="margin-top:0;">Log Sleep</h3>
              <form id="sleepForm">
                <label for="sleepHours">Hours Slept</label>
                <input type="number" id="sleepHours" name="sleepHours" min="0" max="24" step="0.1" placeholder="E.g. 7.5" required style="width:100%;padding:10px;border-radius:8px;border:1.2px solid #e0e3f3;margin-bottom:10px;">
                <button type="submit" class="btn btn-primary" style="width:100%;">Save</button>
              </form>
            </div>
          </div>
          <div class="activity-modal" id="hydrationModal" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);align-items:center;justify-content:center;">
            <div style="background:#fff;padding:22px 18px 18px 18px;border-radius:16px;max-width:90vw;width:320px;box-shadow:0 2px 12px 0 rgba(93,95,239,0.13);position:relative;">
              <button class="close-modal-btn" data-modal="hydrationModal" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.2em;color:#888;cursor:pointer;"><i class="fas fa-times"></i></button>
              <h3 style="margin-top:0;">Log Hydration</h3>
              <form id="hydrationForm">
                <label for="hydrationLiters">Water Drank (liters)</label>
                <input type="number" id="hydrationLiters" name="hydrationLiters" min="0" max="10" step="0.1" placeholder="E.g. 2.0" required style="width:100%;padding:10px;border-radius:8px;border:1.2px solid #e0e3f3;margin-bottom:10px;">
                <button type="submit" class="btn btn-primary" style="width:100%;">Save</button>
              </form>
            </div>
          </div>
          <div class="activity-modal" id="screenTimeModal" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);align-items:center;justify-content:center;">
            <div style="background:#fff;padding:22px 18px 18px 18px;border-radius:16px;max-width:90vw;width:320px;box-shadow:0 2px 12px 0 rgba(93,95,239,0.13);position:relative;">
              <button class="close-modal-btn" data-modal="screenTimeModal" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.2em;color:#888;cursor:pointer;"><i class="fas fa-times"></i></button>
              <h3 style="margin-top:0;">Log Screen Time</h3>
              <form id="screenTimeForm">
                <label for="screenTimeHours">Screen Time (hours)</label>
                <input type="number" id="screenTimeHours" name="screenTimeHours" min="0" max="24" step="0.1" placeholder="E.g. 3.5" required style="width:100%;padding:10px;border-radius:8px;border:1.2px solid #e0e3f3;margin-bottom:10px;">
                <button type="submit" class="btn btn-primary" style="width:100%;">Save</button>
              </form>
            </div>
          </div>
          <div class="activity-modal" id="walkModal" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);align-items:center;justify-content:center;">
            <div style="background:#fff;padding:22px 18px 18px 18px;border-radius:16px;max-width:90vw;width:320px;box-shadow:0 2px 12px 0 rgba(93,95,239,0.13);position:relative;">
              <button class="close-modal-btn" data-modal="walkModal" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.2em;color:#888;cursor:pointer;"><i class="fas fa-times"></i></button>
              <h3 style="margin-top:0;">Log Walk</h3>
              <form id="walkForm">
                <label for="walkSteps">Steps Walked</label>
                <input type="number" id="walkSteps" name="walkSteps" min="0" max="50000" step="1" placeholder="E.g. 6000" required style="width:100%;padding:10px;border-radius:8px;border:1.2px solid #e0e3f3;margin-bottom:10px;">
                <button type="submit" class="btn btn-primary" style="width:100%;">Save</button>
              </form>
            </div>
          </div>
        </div>
        <script>
        // Activity icon click handlers
        document.addEventListener('DOMContentLoaded', function() {
          const modals = {
            sleepIconBtn: 'sleepModal',
            hydrationIconBtn: 'hydrationModal',
            screenTimeIconBtn: 'screenTimeModal',
            walkIconBtn: 'walkModal'
          };
          Object.keys(modals).forEach(function(btnId) {
            const btn = document.getElementById(btnId);
            if (btn) {
              btn.addEventListener('click', function() {
                document.getElementById(modals[btnId]).style.display = 'flex';
              });
            }
          });
          // Close modal buttons
          document.querySelectorAll('.close-modal-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
              const modalId = btn.getAttribute('data-modal');
              document.getElementById(modalId).style.display = 'none';
            });
          });
          // Optional: Close modal on background click
          document.querySelectorAll('.activity-modal').forEach(function(modal) {
            modal.addEventListener('click', function(e) {
              if (e.target === modal) modal.style.display = 'none';
            });
          });
        });
        </script>
        </div>
      </div>
    </div>
    
    <div class="mobile-view hidden" id="recordView">
      <div class="mobile-header">
        <h1>Journal</h1>
      </div>
      <div class="mobile-content">
        <div class="section-container">
          <div class="activity-section">
            <div class="section-title">
              <h3>Journal</h3>
            </div>
            <div class="action-buttons scan-buttons">
              <button id="recordJournalBtn" class="btn btn-primary fade-in">
                <i class="fas fa-microphone"></i> Record a Journal
              </button>
              <button id="logJournalBtn" class="btn btn-secondary fade-in">
                <i class="fas fa-keyboard"></i> Log Journal Manually
              </button>
              <button id="viewJournalHistoryBtn" class="btn btn-outline fade-in" style="margin-top: 10px;">
                <i class="fas fa-history"></i> View Journal History
              </button>
            </div>
            <!-- Voice Journal Section (hidden by default, shown on Record a Journal) -->
            <div class="voice-transcription-section modern-voice-journal" id="voiceJournalSection" style="display:none;">
              <div class="voice-header modern-voice-header">
                <div class="voice-mic-bg">
                  
                </div>
                <!-- <h2 class="voice-title">Voice Journal</h2> -->
                <p class="voice-desc">Tap the button and start speaking to record your thoughts or mood.</p>
              </div>
              <div class="voice-controls modern-voice-controls">
                <button id="startTranscriptionBtn" class="btn btn-primary modern-voice-btn">
                  <i class="fas fa-microphone"></i> Start Recording
                </button>
                <button id="stopTranscriptionBtn" class="btn btn-secondary modern-voice-btn" style="display:none;">
                  <i class="fas fa-stop"></i> Stop
                </button>
              </div>
              <div class="transcription-status modern-transcription-status" id="transcriptionStatus" style="display:none;">
                <span class="mic-pulse-bg"><i class="fas fa-microphone-alt pulse"></i></span>
                <span>Listening...</span>
              </div>
              <div class="transcription-result modern-transcription-result" id="transcriptionResult" style="display:none;"></div>
              <div class="transcription-actions modern-transcription-actions" id="transcriptionActions" style="display:none;">
                <button id="saveTranscriptionBtn" class="btn btn-primary modern-voice-btn">
                  <i class="fas fa-save"></i> Save Entry
                </button>
                <button id="discardTranscriptionBtn" class="btn btn-secondary modern-voice-btn">
                  <i class="fas fa-times"></i> Discard
                </button>
              </div>
            </div>
            <!-- Manual Journal Section (hidden by default, shown on Log Journal Manually) -->
            <div class="log-journal-container fade-in" id="logJournalContainer" style="display:none;">
              <div class="log-journal-header">
                <h3>Log Journal Manually</h3>
                <p>Write your thoughts, feelings, or experiences below (e.g., "Today I felt happy after my walk").</p>
              </div>
              <div class="journal-description-wrapper" style="position:relative;display:flex;align-items:flex-start;gap:8px;">
                <textarea id="journalDescription" class="journal-description" placeholder="Write your journal entry here..." style="flex:1;min-height:90px;max-width:100%;border-radius:12px;padding:12px 14px;font-size:1em;border:1.5px solid #5D5FEF;background:#f7f8ff;"></textarea>
                <!-- Optionally, add a mic button for speech-to-text in future -->
              </div>
              <div class="log-journal-actions" style="display:flex;gap:10px;margin-top:12px;">
                <button id="submitJournalLog" class="btn btn-primary">
                  <i class="fas fa-check"></i> Save Journal
                </button>
                <button id="cancelJournalLog" class="btn btn-secondary">
                  <i class="fas fa-times"></i> Cancel
                </button>
              </div>
            </div>
            <!-- Journal History Section (hidden by default) -->
            <div id="journalHistorySection" class="fade-in" style="display:none;margin-top:18px;">
              <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
                <h3 style="margin:0;font-size:1.1em;">Journal History</h3>
                <button id="closeJournalHistoryBtn" class="btn btn-secondary btn-sm" style="padding:4px 12px;font-size:0.95em;">
                  <i class="fas fa-times"></i> Close
                </button>
              </div>
              <div id="journalHistoryContainer" style="min-height:60px;background:#f7f8ff;border-radius:10px;padding:10px 8px 8px 8px;box-shadow:0 1px 6px 0 rgba(93,95,239,0.04);">
                <!-- Journal entries will be loaded here by JS -->
                <div id="emptyJournalHistory" style="text-align:center;color:#888;padding:18px 0;display:none;">
                  <i class="fas fa-book" style="font-size:1.5em;"></i>
                  <div style="margin-top:6px;">No journal entries yet</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="mobile-view hidden" id="communityView">
      <div class="mobile-header">
        <h1>Food History</h1>
        <button id="refreshHistoryBtn" class="refresh-header-btn">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>
      
      <div class="mobile-content history-container">
        <div class="filter-container">
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search food items...">
          </div>
          
          <div class="filter-row">
            <div class="dropdown">
              <select id="sortBy">
                <option value="date-desc">Newest First</option>
                <option value="date-asc">Oldest First</option>
                <option value="calories-desc">Calories (High-Low)</option>
                <option value="calories-asc">Calories (Low-High)</option>
                <option value="health-desc">Health (High-Low)</option>
                <option value="health-asc">Health (Low-High)</option>
              </select>
            </div>

            <div class="dropdown">
              <select id="filterHealthScore">
                <option value="all">All Health Scores</option>
                <option value="8">Very Healthy</option>
                <option value="5">Moderately Healthy</option>
                <option value="1">Less Healthy</option>
              </select>
            </div>
          </div>
        </div>
        
        <div id="historyContainer">
          <!-- History items will be inserted here by JavaScript -->
           
        </div>
        
        <div class="empty-history" id="emptyHistory" style="display: none;">
          <div class="empty-history-content">
            <i class="fas fa-utensils"></i>
            <h3>No food history yet</h3>
            <p>Take a picture of your meal to start tracking your nutrition!</p>
          </div>
        </div>
        
        <div class="pagination" id="pagination">
          <!-- Pagination will be inserted here by JavaScript -->
        </div>
      </div>
    </div>
    
    <div class="mobile-view hidden" id="profileView">
      <div class="mobile-header">
        <h1>Profile</h1>
      </div>
      
      <div class="mobile-content">
        <div class="profile-card">
          <div class="profile-avatar">
            <i class="fas fa-user-circle"></i>
          </div>
          <h2 id="profileUserEmail">user@example.com</h2>
          <p>Member since <span id="memberSince">2025</span></p>
        </div>
        
        <div class="profile-menu">
          <a href="#" class="profile-menu-item" id="viewGoals">
            <i class="fas fa-chart-line"></i>
            <span>Goals</span>
            <i class="fas fa-chevron-right"></i>
          </a>
          <div class="profile-menu-item" id="viewSettings">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
            <i class="fas fa-chevron-right"></i>
          </div>
          <a href="#" class="profile-menu-item">
            <i class="fas fa-question-circle"></i>
            <span>Help & Support</span>
            <i class="fas fa-chevron-right"></i>
          </a>
          <div class="profile-menu-item" id="viewTermsAndPrivacy">
            <i class="fas fa-file-alt"></i>
            <span>Terms & Privacy</span>
            <i class="fas fa-chevron-right"></i>
          </div>
        </div>
        
        <button id="logoutBtn" class="logout-btn">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </button>
      </div>
    </div>

    <div class="mobile-view hidden" id="goalsView">
      <div class="mobile-header">
        <h1>Goals</h1>
      </div>
      
      <div class="mobile-content">
        <div class="settings-section">
          <h2>Set Your Goals</h2>
          <p>Choose your fitness goals to get personalized recommendations.</p>
          <div class="settings-item goal-card" id="loseWeightGoal">
            <div class="settings-item-info">
              <i class="fas fa-weight settings-icon"></i>
              <div>
                <h3>Lose Weight</h3>
                <p>Focus on fat loss and a leaner physique</p>
              </div>
            </div>
          </div>
          <div class="settings-item goal-card" id="gainMuscleGoal">
            <div class="settings-item-info">
              <i class="fas fa-dumbbell settings-icon"></i>
              <div>
                <h3>Gain Muscle</h3>
                <p>Build muscle mass and strength</p>
              </div>
            </div>
          </div>
          <div class="settings-item goal-card" id="maintainWeightGoal">
            <div class="settings-item-info">
              <i class="fas fa-balance-scale settings-icon"></i>
              <div>
                <h3>Maintain Weight</h3>
                <p>Stay healthy and keep your current weight</p>
              </div>
            </div>
          </div>
        </div>
        <button class="back-button" id="backToProfileBtn">
          <i class="fas fa-arrow-left"></i> Back to Profile
        </button>
      </div>
    </div>
    <div class="mobile-view hidden" id="settingsView">

      <div class="mobile-header">
        <h1>Settings</h1>
      </div>
      
      <div class="mobile-content">
        <div class="settings-section">
          <h2>App Settings</h2>
          
          <div class="settings-item">
            <div class="settings-item-info">
              <i class="fas fa-moon settings-icon"></i>
              <div>
                <h3>Dark Mode</h3>
                <p>Toggle dark theme for the app</p>
              </div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="darkModeToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="settings-item">
            <div class="settings-item-info">
              <i class="fas fa-expand settings-icon"></i>
              <div>
                <h3>Fullscreen Mode</h3>
                <p>Make app use entire screen</p>
              </div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="fullscreenToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="settings-item">
            <div class="settings-item-info">
              <i class="fas fa-bell settings-icon"></i>
              <div>
                <h3>Notifications</h3>
                <p>Enable push notifications</p>
              </div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
    
        <div class="settings-section">
          <h2>Account</h2>
          
          <div class="settings-item" id="editProfileSetting">
            <div class="settings-item-info">
              <i class="fas fa-user settings-icon"></i>
              <div>
                <h3>Edit Profile</h3>
                <p>Update your personal information</p>
              </div>
            </div>
            <i class="fas fa-chevron-right settings-arrow"></i>
          </div>
          
          <div class="settings-item" id="changePasswordSetting">
            <div class="settings-item-info">
              <i class="fas fa-lock settings-icon"></i>
              <div>
                <h3>Change Password</h3>
                <p>Update your security settings</p>
              </div>
            </div>
            <i class="fas fa-chevron-right settings-arrow"></i>
          </div>
        </div>
          
        <div class="settings-section">
          <h2>About</h2>
          
          <div class="settings-item" id="viewTermsAndPrivacySettings">
            <div class="settings-item-info">
              <i class="fas fa-file-alt settings-icon"></i>
              <div>
                <h3>Terms & Privacy</h3>
                <p>View our terms and privacy policy</p>
              </div>
            </div>
            <i class="fas fa-chevron-right settings-arrow"></i>
          </div>
          
          <div class="settings-item" id="addToHomeScreen">
            <div class="settings-item-info">
              <i class="fas fa-download settings-icon"></i>
              <div>
                <h3>Add to Home Screen</h3>
                <p>Get app-like experience</p>
              </div>
            </div>
            <i class="fas fa-chevron-right settings-arrow"></i>
          </div>
          
          <div class="settings-item">
            <div class="settings-item-info">
              <i class="fas fa-info-circle settings-icon"></i>
              <div>
                <h3>App Version</h3>
                <p>1.0.0</p>
              </div>
            </div>
          </div>
        </div>
        
        <button class="back-button" id="backToProfileBtn">
          <i class="fas fa-arrow-left"></i> Back to Profile
        </button>
      </div>
    </div>
    
    <div class="mobile-view hidden" id="termsView">
      <div class="mobile-header">
        <h1>Terms & Privacy</h1>
      </div>
      <div class="mobile-content">
        <div class="tabs">
            <button class="tab-btn active" data-tab="terms" id="termsTab">Terms of Service</button>
            <button class="tab-btn" data-tab="privacy" id="privacyTab">Privacy Policy</button>
        </div>

        <div class="tab-content" id="terms-tab" style="display: block;">
            <div class="content-section">
                <h2>Terms of Service</h2>
                <p class="last-updated">Last Updated: May 12, 2025</p>
                <div class="terms-section">
                <h3>1. Acceptance of Terms</h3>
                <p>By accessing or using the MindScribe Health & Wellness App (the App), you agree to be bound by these Terms of Service. If you do not agree with any part of these terms, you should not use the App.</p>
                </div>

                <div class="terms-section">
                  <h3>2. Description of Service</h3>
                  <p>The App provides tools to support mental and physical well-being, including voice journaling, mood and sentiment analysis, and optional fitness and calorie tracking. We reserve the right to modify, suspend, or discontinue any part of the service at any time without prior notice.</p>
                </div>

                <div class="terms-section">
                  <h3>3. User Accounts</h3>
                  <p>Certain features require you to create an account. You are responsible for maintaining the confidentiality of your login information and for all activity under your account. You must notify us immediately of any unauthorized use or suspected breach.</p>
                </div>

                <div class="terms-section">
                  <h3>4. User Content</h3>
                  <p>You retain ownership of any content you submit through the App (e.g., journal entries, logs), but grant us a non-exclusive, worldwide license to use, store, and process your content solely to provide and improve the service.</p>
                </div>

                <div class="terms-section">
                  <h3>5. Prohibited Conduct</h3>
                  <p>You agree not to misuse the App. This includes, but is not limited to, uploading harmful code, attempting unauthorized access to other accounts, interfering with the services operation, or using it for unlawful or abusive purposes.</p>
                </div>

                <div class="terms-section">
                  <h3>6. Data & Privacy</h3>
                  <p>We respect your privacy and process your data in accordance with our Privacy Policy. Your personal and journal data will not be shared or sold without your consent. You may request data deletion at any time.</p>
                </div>

                <div class="terms-section">
                  <h3>7. Limitation of Liability</h3>
                  <p>The App is provided on an as is basis. We do not guarantee specific outcomes from using the service. We are not liable for any indirect, incidental, or consequential damages arising from your use or inability to use the App.</p>
                </div>

                <div class="terms-section">
                  <h3>8. Modifications to Terms</h3>
                  <p>We may update these Terms from time to time. We will notify users of significant changes via email or through an in-app notification. Continued use of the App after changes take effect constitutes acceptance of the new terms.</p>
                </div>

                <div class="terms-section">
                  <h3>9. Termination</h3>
                  <p>We reserve the right to suspend or terminate your account at any time if you violate these Terms, disrupt the service, or pose a security or legal risk. Upon termination, your access will be revoked and your data may be deleted.</p>
                </div>

                <div class="terms-section">
                  <h3>10. Governing Law</h3>
                  <p>These Terms shall be governed by the laws of the jurisdiction in which the App operates. Any disputes arising from the Terms will be resolved in the applicable local courts.</p>
                </div>

            </div>
        </div>
        <div class="tab-content" id="privacy-tab" style="display: none;">
            <div class="content-section">
                <h2>Privacy Policy</h2>
                <p class="last-updated">Last Updated: May 12, 2025</p>
                <div class="terms-section">
               <h3>1. Information We Collect</h3>
              <p>We collect information you provide directly, including your name, email address, journal entries, food images, and any other data you submit. We also automatically collect usage data such as device type, IP address, and interaction patterns within the app.</p>
              </div>
              <div class="terms-section">
                <h3>2. How We Use Your Information</h3>
                <p>We use your information to operate, maintain, and improve our services, including AI-based journaling, calorie analysis, and user insights. Food images may be used to train machine learning models to improve our AIs accuracy. We do not use your data for advertising purposes.</p>
              </div>

              <div class="terms-section">
                <h3>3. Data Storage</h3>
                <p>Your data is stored securely on cloud-based servers. Journal entries, voice transcripts, food logs, and analysis results are retained as part of your account history unless you choose to delete them.</p>
              </div>

              <div class="terms-section">
                <h3>4. Sharing of Information</h3>
                <p>We do not sell or rent your personal information. We may share limited data with trusted service providers who help us deliver key app functionality (such as hosting or AI analysis), and only to the extent necessary to provide those services securely and reliably.</p>
              </div>

              <div class="terms-section">
                <h3>5. Data Security</h3>
                <p>We take your privacy seriously and use encryption, access controls, and other industry-standard measures to protect your data. However, no method of data transmission over the Internet or storage is completely secure, and we cannot guarantee absolute security.</p>
              </div>

              <div class="terms-section">
                <h3>6. Your Rights</h3>
                <p>You have the right to access, update, or delete your personal data at any time. You can do this via your account settings or by contacting us directly. We will process such requests promptly, in accordance with applicable privacy laws.</p>
              </div>

              <div class="terms-section">
                <h3>7. Cookies & Tracking Technologies</h3>
                <p>We may use cookies, local storage, or similar technologies to improve functionality, personalize your experience, and analyze usage. You may control these preferences through your browser or device settings.</p>
              </div>

              <div class="terms-section">
                <h3>8. Children's Privacy</h3>
                <p>Our services are not intended for children under the age of 13. We do not knowingly collect or store personal information from anyone under 13. If we become aware that such information has been collected, we will take steps to delete it.</p>
              </div>

              <div class="terms-section">
                <h3>9. Updates to This Policy</h3>
                <p>We may update this privacy policy periodically. When we do, we will revise the "Last Updated" date and notify users of any significant changes through the app or email.</p>
              </div>

              <div class="terms-section">
                <h3>10. Contact Us</h3>
                <p>If you have questions or concerns about this Privacy Policy or your data, please contact us at <a href="mailto:mindscribe@rojansapkota.com.np">mindscribe@rojansapkota.com.np</a>.</p>
              </div>
            </div>
        </div>
      </div>
    </div>
    
    <!-- AI Chat Section -->
    <div class="mobile-view hidden" id="aiView">
      <div class="mobile-header ai-chat-header" style="background:linear-gradient(90deg,#232347 70%,#34D399 100%);color:#fff;height:52px;padding:0 12px 0 8px;border-radius:0 0 16px 16px;box-shadow:0 2px 8px 0 rgba(93,95,239,0.08);display:flex;align-items:center;justify-content:space-between;">
        <div style="display:flex;align-items:center;gap:8px;">
          <i class="fas fa-robot" style="font-size:1.3em;"></i>
          <span style="font-size:1.05em;font-weight:600;letter-spacing:0.5px;">Ask AI</span>
        </div>
        <button id="closeAIChatBtn" class="close-header-btn" onclick="switchTab('homeView')" style="background:none;border:none;color:#fff;font-size:1.1em;padding:4px 8px;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="mobile-content" style="background:linear-gradient(180deg,#232347 80%,#232347 100%);padding:0;display:flex;flex-direction:column;height:calc(100dvh - 52px);">
        <div class="welcome-card" style="margin:18px 12px 10px 12px;background:rgba(52,211,153,0.08);color:#fff;">
          <div class="welcome-avatar" style="background:rgba(93,95,239,0.13);color:#34D399;">
            <i class="fas fa-robot"></i>
          </div>
          <h2 style="font-size:1.1em;">AI Chat</h2>
          <p style="font-size:0.98em;color:#b3b3cc;">Ask anything about nutrition, mental health, or wellness!</p>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages" style="flex:1 1 0;overflow-y:auto;padding:0 12px 0 12px;display:flex;flex-direction:column;gap:10px;min-height:0;">
          <!-- Messages will be rendered here -->
        </div>
        <form id="aiChatForm" class="ai-chat-form" style="display:flex;gap:8px;padding:0 8px 18px 8px;position:fixed;left:0;right:0;bottom:0;width:100vw;max-width:480px;margin:auto;background:linear-gradient(180deg,#232347 90%,#232347 100%);z-index:100;">
          <button type="button" id="aiMicBtn" class="btn btn-secondary" style="padding:0 12px;border-radius:50%;background:#5D5FEF;border:none;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px 0 rgba(52,211,153,0.10);min-width:40px;min-height:40px;">
            <i class="fas fa-microphone" style="color:#fff;font-size:1.1em;"></i>
          </button>
          <input type="text" id="aiChatInput" class="ai-chat-input" placeholder="Type your question..." autocomplete="off" style="flex:1;padding:13px 14px;border-radius:18px;border:1.5px solid #34D399;font-size:1em;outline:none;background:#232347;color:#fff;box-shadow:0 1px 4px 0 rgba(93,95,239,0.04);margin-bottom:0;">
          <button type="submit" class="btn btn-primary" style="padding:0 16px;border-radius:50%;background:#5D5FEF;border:none;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px 0 rgba(93,95,239,0.10);min-width:40px;min-height:40px;">
          <i class="fas fa-paper-plane" style="color:#fff;font-size:1.1em;"></i>
          </button>
        </form>
      </div>
    </div>
    <!-- End AI Chat Section -->
     
    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <button class="nav-item active" data-view="homeView">
        <i class="fas fa-home"></i>
        <span>Home</span>
      </button>
      <button class="nav-item" data-view="activityView">
        <i class="fas fa-bolt"></i>
        <span>Activity</span>
      </button>
      <button class="nav-item nav-item-record" data-view="recordView">
        <div class="scan-button-wrapper">
          <div class="scan-button-inner">
            <i class="fas fa-book"></i>
          </div>
        </div>
        <span>Journal</span>
      </button>
      <button class="nav-item" data-view="communityView">
        <i class="fas fa-history"></i>
        <span>History</span>
      </button>
      <button class="nav-item" data-view="profileView">
        <i class="fas fa-user"></i>
        <span>Profile</span>
      </button>
    </nav>
  </div>
  
  
  <div class="tooltip" id="tooltip"></div>
  <script src="../JS/mobile.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      if (!isMobile) {
        window.location.href = 'desktop.html';
      }
      
      // Check fullscreen preference (default is false)
      let fullscreenEnabled = localStorage.getItem('fullscreenEnabled') === 'true';
      
      // Handle fullscreen mode
      function enterFullscreen() {
        const docEl = document.documentElement;
        
        if (docEl.requestFullscreen) {
          docEl.requestFullscreen();
        } else if (docEl.webkitRequestFullscreen) { /* Safari */
          docEl.webkitRequestFullscreen();
        } else if (docEl.msRequestFullscreen) { /* IE11 */
          docEl.msRequestFullscreen();
        }
      }
      
      function exitFullscreen() {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) { /* Safari */
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { /* IE */
          document.msExitFullscreen();
        }
      }
      
      // Check if it's a standalone PWA
      const isInStandaloneMode = window.matchMedia('(display-mode: standalone)').matches || 
                                (window.navigator.standalone) || 
                                document.referrer.includes('android-app://');
      
      // Toggle fullscreen based on user preference and if not already in standalone mode
      if (fullscreenEnabled && !isInStandaloneMode) {
        // Attempt fullscreen on first user interaction for better UX
        document.addEventListener('click', function firstInteraction() {
          enterFullscreen();
          document.removeEventListener('click', firstInteraction);
        }, { once: true });
      }
      
      // Initialize the fullscreen toggle once the DOM is fully loaded
      window.addEventListener('load', () => {
        const fullscreenToggle = document.getElementById('fullscreenToggle');
        if (fullscreenToggle) {
          fullscreenToggle.checked = fullscreenEnabled;
          
          fullscreenToggle.addEventListener('change', function() {
            fullscreenEnabled = this.checked;
            localStorage.setItem('fullscreenEnabled', fullscreenEnabled);
            
            if (fullscreenEnabled && !isInStandaloneMode) {
              enterFullscreen();
            } else if (!fullscreenEnabled) {
              exitFullscreen();
            }
          });
        }
      });
    });

    document.addEventListener('DOMContentLoaded', function() {
      // Add navigation for Goals
      var viewGoals = document.getElementById('viewGoals');
      if (viewGoals) {
        viewGoals.addEventListener('click', function(e) {
          e.preventDefault();
          if (typeof switchTab === 'function') {
            switchTab('goalsView');
          }
        });
      }
      // Add back button for Goals view
      var backToProfileBtns = document.querySelectorAll('#goalsView .back-button');
      backToProfileBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          if (typeof switchTab === 'function') {
            switchTab('profileView');
          }
        });

      
      });
    });
  </script>
</body>
</html>